function validateField(e){return void 0===e.validate||(e.validate.required&&0==e.value.length?{error:e.validate.required.error}:e.validate.pattern&&!e.value.match(e.validate.pattern.reg)?{error:e.validate.pattern.error}:!e.validate.callback||e.validate.callback(e.value))}function validateForm(e){var r=e.data;e.preventDefault();var s=[];for(var o in r.fields)if(r.fields.hasOwnProperty(o)){var a=$(this).find('[data-field="'+o+'"]'),n=a.val();r.fields[o].value=n;var t=validateField(r.fields[o]);!0!==t?("function"==typeof r.fields[o].onError?r.fields[o].onSubmitError(a,t):onSubmitError(a,t),s.push(t)):"function"==typeof r.fields[o].onSuccess?r.fields[o].onSuccess(a):onSuccess(a)}if(0==s.length){var i=$(this),d=forms.filter(function(e){return e.id==i.attr("id")});0==d.length?(console.log("No form set"),onFormSuccess($(this))):"function"==typeof d[0].onFormSuccess?d[0].onFormSuccess($(this)):onFormSuccess($(this))}}function validateSingleField(e){var r=e.data,s=$(this);r.value=s.val();var o=validateField(r);!0!==o?"function"==typeof r.onError?r.onFieldError(s,o):onFieldError(s,o):"function"==typeof r.onSuccess?r.onSuccess(s):onSuccess(s)}function onFieldError(e,r){$(e).parent().addClass("has-error"),$(e).parent().removeClass("has-success")}function onSubmitError(e,r){$(e).parent().addClass("has-error"),$(e).parent().removeClass("has-success"),0==$(e).parent().find(".error-text").length&&$(e).parent().append('<span class="error-text">'+r.error+"</span>")}function onSuccess(e){$(e).parent().removeClass("has-error"),$(e).parent().addClass("has-success"),$(e).parent().find(".error-text").remove()}function onFormSuccess(e){console.log(e,"success")}for(var phoneFormSuccess=function(e){var r=e.serialize();r+="&r="+document.referrer,e.addClass("is-loading"),e.find("button").attr("disabled","disabled"),$.ajax({url:"/backend/send",method:"POST",data:r,context:e,success:function(e){var r=$(this);dataLayer.push({event:"formsend",eventCategory:"form",eventAction:"send-btn",eventLabel:r.attr("id")}),setTimeout(function(){r.removeClass("is-loading"),r.addClass("is-success"),r.append('<span class="message message-success">'+e+"</span>")},2e3)},error:function(r){setTimeout(function(){e.removeClass("is-loading"),e.addClass("is-error"),e.append('<span class="message message-error">'+r+"</span>")},2e3)}})},detailedFormSuccess=function(e){console.log(e[0]);var r=new FormData(e[0]);r.append("r",document.referrer),e.addClass("is-loading"),e.find("button").attr("disabled","disabled"),$.ajax({url:"/backend/detailed",method:"POST",data:r,context:e,processData:!1,contentType:!1,success:function(e){var r=$(this);console.log(r.attr("id"),e),dataLayer.push({event:"formsend",eventCategory:"form",eventAction:"send-btn",eventLabel:r.attr("id")}),setTimeout(function(){r.removeClass("is-loading"),r.addClass("is-success"),r.append('<span class="message message-success">'+e+"</span>")},2e3)},error:function(e){console.log($(this),e),$(this).removeClass("is-loading")}})},fields={phone:{value:"",validate:{required:{error:"Заполните поле телефон"},pattern:{reg:/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/,error:"Заполните поле телефон в правильном формате"}}},name:{value:"",validate:{required:{error:"Заполните поле имя"},pattern:{reg:/[а-яА-Я\s]+/,error:"В поле имени введены недопустимые символы"}}},description:{value:"",validate:{required:{error:"Введите описание ноутбука"},callback:function(e){return e.length>10&&e.length<200||{error:"Длина описания должна быть больше 10 и меньше 200 символов"}}}},model:{value:"",validate:{required:{error:"Укажите, пожалуйста, модель ноутбука"},callback:function(e){return e.length>4&&e.length<50||{error:"Длина названия модели должна быть больше 4 и меньше 50 символов"}}}},notebook:{value:"",validate:{required:{error:"Укажите, пожалуйста, марку ноутбука"}}},state:{value:"",validate:{required:{error:"Укажите, пожалуйста, состояние ноутбука"}}},photo:{value:"",validate:{required:{error:"Укажите, пожалуйста, фото ноутбука"}}}},forms=[{id:"s1-form",fields:{phone:fields.phone},onFormSuccess:phoneFormSuccess},{id:"modal-form-2",fields:{phone:fields.phone},onFormSuccess:phoneFormSuccess},{id:"prefooter-form",fields:{phone:fields.phone},onFormSuccess:phoneFormSuccess},{id:"modal-form",fields:{name:fields.name,phone:fields.phone,description:fields.description,notebook:fields.notebook,photo:fields.photo,state:fields.state,model:fields.model},onFormSuccess:detailedFormSuccess}],i=0;i<forms.length;i++){$("#"+forms[i].id).on("submit",forms[i],validateForm);for(var k in forms[i].fields)$("#"+forms[i].id).find('[data-field="'+k+'"]').on("keyup",forms[i].fields[k],validateSingleField),$("#"+forms[i].id).find('[data-field="'+k+'"]').on("change",forms[i].fields[k],validateSingleField)}$(document).on("click",".error-text",function(e){$(this).remove()}),$('[data-field="phone"]').on("keypress",function(e){$(this).val($(this).val().replace(/^\+7 \(8/,"+7 ("))});