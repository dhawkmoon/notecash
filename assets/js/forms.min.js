function validateField(a){if(typeof a.validate!="undefined"){if(a.validate.required){if(a.value.length==0){return{error:a.validate.required.error,}}}if(a.validate.pattern){if(!a.value.match(a.validate.pattern.reg)){return{error:a.validate.pattern.error,}}}if(a.validate.callback){return a.validate.callback(a.value)}return true}else{return true}}function validateForm(d){var c=d.data;d.preventDefault();var h=[];for(var b in c.fields){if(c.fields.hasOwnProperty(b)){var g=$(this).find('[data-field="'+b+'"]');var j=g.val();c.fields[b].value=j;var m=validateField(c.fields[b]);if(m!==true){if(typeof c.fields[b].onError=="function"){c.fields[b].onSubmitError(g,m)}else{onSubmitError(g,m)}h.push(m)}else{if(typeof c.fields[b].onSuccess=="function"){c.fields[b].onSuccess(g)}else{onSuccess(g)}}}}if(h.length==0){var l=$(this);var a=forms.filter(function(e){return e.id==l.attr("id")});if(a.length==0){console.log("No form set");onFormSuccess($(this))}else{if(typeof a[0].onFormSuccess=="function"){a[0].onFormSuccess($(this))}else{onFormSuccess($(this))}}}}function validateSingleField(d){var c=d.data;var b=$(this);c.value=b.val();var a=validateField(c);if(a!==true){if(typeof c.onError=="function"){c.onFieldError(b,a)}else{onFieldError(b,a)}}else{if(typeof c.onSuccess=="function"){c.onSuccess(b)}else{onSuccess(b)}}}function onFieldError(b,a){$(b).parent().addClass("has-error");$(b).parent().removeClass("has-success")}function onSubmitError(b,a){$(b).parent().addClass("has-error");$(b).parent().removeClass("has-success");if($(b).parent().find(".error-text").length==0){$(b).parent().append('<span class="error-text">'+a.error+"</span>")}}function onSuccess(a){$(a).parent().removeClass("has-error");$(a).parent().addClass("has-success");$(a).parent().find(".error-text").remove()}function onFormSuccess(a){console.log(a,"success")}var phoneFormSuccess=function(a){var b=a.serialize();a.addClass("is-loading");a.find("button").attr("disabled","disabled");console.log(b);$.ajax({url:"/backend/send",method:"POST",data:b,context:a,success:function(c){var d=$(this);dataLayer.push({event:"formsend",eventCategory:"form",eventAction:"send-btn",eventLabel:d.attr("id"),});setTimeout(function(){d.removeClass("is-loading");d.addClass("is-success");d.append('<span class="message message-success">'+c+"</span>")},2000)},error:function(c){setTimeout(function(){a.removeClass("is-loading");a.addClass("is-success");a.append('<span class="message message-error" style="position:relative; top:40px;">'+c.responseText+"</span>")},2000)},})};var detailedFormSuccess=function(a){console.log(a[0]);var b=new FormData(a[0]);a.addClass("is-loading");a.find("button").attr("disabled","disabled");$.ajax({url:"/backend/detailed",method:"POST",data:b,context:a,processData:false,contentType:false,success:function(c){var d=$(this);console.log(d.attr("id"),c);dataLayer.push({event:"formsend",eventCategory:"form",eventAction:"send-btn",eventLabel:d.attr("id"),});setTimeout(function(){d.removeClass("is-loading");d.addClass("is-success");d.append('<span class="message message-success">'+c+"</span>")},2000)},error:function(c){setTimeout(function(){a.removeClass("is-loading");a.addClass("is-success");a.append('<span class="message message-error">'+c.responseText+"</span>")},2000)},})};var fields={phone:{value:"",validate:{required:{error:"Заполните поле телефон",},pattern:{reg:/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/,error:"Заполните поле телефон в правильном формате",}},},name:{value:"",validate:{required:{error:"Заполните поле имя",},pattern:{reg:/[а-яА-Я\s]+/,error:"В поле имени введены недопустимые символы",}}},description:{value:"",validate:{required:{error:"Введите описание ноутбука",},callback:function(a){if(a.length>10&&a.length<200){return true}else{return{error:"Длина описания должна быть больше 10 и меньше 200 символов"}}}},},model:{value:"",validate:{required:{error:"Укажите, пожалуйста, модель ноутбука",},callback:function(a){if(a.length>4&&a.length<50){return true}else{return{error:"Длина названия модели должна быть больше 4 и меньше 50 символов"}}}},},notebook:{value:"",validate:{required:{error:"Укажите, пожалуйста, марку ноутбука"}}},state:{value:"",validate:{required:{error:"Укажите, пожалуйста, состояние ноутбука"}}},photo:{value:"",validate:{required:{error:"Укажите, пожалуйста, фото ноутбука"}}},};var forms=[{id:"s1-form",fields:{phone:fields.phone,},onFormSuccess:phoneFormSuccess,},{id:"modal-form-2",fields:{phone:fields.phone,},onFormSuccess:phoneFormSuccess,},{id:"prefooter-form",fields:{phone:fields.phone,},onFormSuccess:phoneFormSuccess,},{id:"modal-form",fields:{name:fields.name,phone:fields.phone,description:fields.description,notebook:fields.notebook,photo:fields.photo,state:fields.state,model:fields.model},onFormSuccess:detailedFormSuccess,},];for(var i=0;i<forms.length;i++){$("#"+forms[i].id).on("submit",forms[i],validateForm);for(var k in forms[i].fields){$("#"+forms[i].id).find('[data-field="'+k+'"]').on("keyup",forms[i].fields[k],validateSingleField);$("#"+forms[i].id).find('[data-field="'+k+'"]').on("change",forms[i].fields[k],validateSingleField)}}$(document).on("click",".error-text",function(a){$(this).remove()});$('[data-field="phone"]').on("keypress",function(a){$(this).val($(this).val().replace(/^\+7 \(8/,"+7 ("))});